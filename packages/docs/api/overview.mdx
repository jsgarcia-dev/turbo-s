# API NestJS

A API TurboS √© constru√≠da com [NestJS](https://nestjs.com/), proporcionando uma base robusta, escal√°vel e bem estruturada para o backend da aplica√ß√£o.

## Arquitetura

A API segue a arquitetura modular do NestJS, organizando o c√≥digo em:

- **M√≥dulos**: Unidades que encapsulam funcionalidades relacionadas
- **Controladores**: Tratam as requisi√ß√µes HTTP e delegam processos
- **Servi√ßos**: Cont√™m a l√≥gica de neg√≥cios
- **Guardas**: Implementam autentica√ß√£o e autoriza√ß√£o
- **Interceptores**: Processam requisi√ß√µes/respostas
- **Filtros**: Tratam exce√ß√µes globalmente

## M√≥dulos Principais

| M√≥dulo           | Descri√ß√£o                  |
| ---------------- | -------------------------- |
| üß© `UsersModule` | Gerenciamento de usu√°rios  |
| üîê `AuthModule`  | Autentica√ß√£o e autoriza√ß√£o |
| üìß `MailModule`  | Envio de emails            |

## Configura√ß√£o do Servidor

O servidor √© configurado no arquivo `main.ts` com as seguintes caracter√≠sticas:

- Prefixo global para todas as rotas (`/api`)
- Documenta√ß√£o Swagger em `/api/docs`
- Prote√ß√£o CORS, Helmet e compress√£o
- Rate limiting (throttling)
- Valida√ß√£o autom√°tica de dados
- Tratamento global de exce√ß√µes
- Logging estruturado com Winston

## Vari√°veis de Ambiente

A API utiliza diversas vari√°veis de ambiente para configura√ß√£o:

```bash
# Servidor
PORT=3001
NODE_ENV=development

# Seguran√ßa
CORS_ORIGIN=http://localhost:3000

# Rotas
API_PREFIX=api
SWAGGER_PATH=docs

# Rate Limiting
THROTTLE_TTL=60000
THROTTLE_LIMIT=100

# Email
MAIL_HOST=
MAIL_PORT=
MAIL_USER=
MAIL_PASS=
MAIL_FROM=

# Storage (Supabase)
SUPABASE_URL=""
SUPABASE_STORAGE_URL=""
SUPABASE_S3_ACCESS_KEY=""
SUPABASE_S3_SECRET_KEY=""
SUPABASE_BUCKET=""
```

## Autentica√ß√£o

A API implementa autentica√ß√£o baseada em JWT (JSON Web Tokens) com:

- Prote√ß√£o de rotas por padr√£o
- Suporte a JWKS (JSON Web Key Sets)
- Controle de acesso baseado em roles (RBAC)
- Autentica√ß√£o stateless

## Documenta√ß√£o Swagger

A documenta√ß√£o da API √© gerada automaticamente usando Swagger/OpenAPI:

- Dispon√≠vel em `http://localhost:3001/api/docs`
- Interface interativa para testar endpoints
- Documenta√ß√£o completa de schemas, par√¢metros e respostas

## Integra√ß√£o com o Database

A API se integra com o pacote `@repo/database` para acesso ao banco de dados:

```typescript
import { prisma } from "@repo/database";

// Exemplo de uso em um servi√ßo
@Injectable()
export class UsersService {
  async findById(id: string) {
    return prisma.user.findUnique({
      where: { id },
    });
  }
}
```

## Logging

A API utiliza Winston para logging estruturado:

- Logs em formatos diferentes por ambiente
- Informa√ß√µes detalhadas em desenvolvimento
- Logs mais concisos em produ√ß√£o

## Considera√ß√µes de Seguran√ßa

A API implementa diversas medidas de seguran√ßa:

- Prote√ß√£o contra DDoS via rate limiting
- Headers seguros com Helmet
- Valida√ß√£o e sanitiza√ß√£o de input
- Tratamento seguro de exce√ß√µes
- Autentica√ß√£o e autoriza√ß√£o robustas
